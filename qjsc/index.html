<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>公寓岗小助手</title>
    <style>
      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        font-family: system-ui, -apple-system, sans-serif;
        margin: 0;
        padding: 16px;
        background-color: #f5f5f5;
        font-size: 16px;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
        background-color: #ffffff;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      /* 新增常用链接样式 */
      .quick-links {
        display: flex;
        gap: 12px;
        margin-bottom: 24px;
      }

      .quick-link-btn {
        flex: 1;
        padding: 14px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        color: white;
        background-color: #2196f3;
        cursor: pointer;
        transition: all 0.2s;
      }

      .quick-link-btn:active {
        background-color: #1976d2;
      }

      h2 {
        text-align: center;
        margin: 0 0 24px 0;
        color: #333;
        font-size: 1.5rem;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .time-group {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .time-group span {
        color: #666;
        font-weight: 600;
      }

      .time-input {
        flex: 1;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        background-color: #fff;
      }

      .time-input:focus {
        outline: none;
        border-color: #2196f3;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #444;
        font-size: 1rem;
      }

      select,
      input {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        appearance: none;
        -webkit-appearance: none;
        background-color: #fff;
      }

      select {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 16px;
        padding-right: 40px;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #2196f3;
      }

      #date {
        background-color: #f8f8f8;
        color: #666;
      }

      .button-group {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 24px;
      }

      button {
        width: 100%;
        padding: 16px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        color: white;
        cursor: pointer;
        transition: all 0.2s;
        -webkit-tap-highlight-color: transparent;
      }

      .generate-btn {
        background-color: #2196f3;
      }

      .generate-btn:active {
        background-color: #1976d2;
      }

      .copy-button {
        background-color: #4caf50;
      }

      .copy-button:active {
        background-color: #45a049;
      }

      .position-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 8px;
        margin-top: 8px;
      }

      .position-btn {
        padding: 12px 4px;
        background-color: #f0f0f0;
        color: #333;
        font-size: 0.9rem;
        font-weight: normal;
      }

      .position-btn.selected {
        background-color: #2196f3;
        color: white;
      }

      .result {
        margin-top: 24px;
        padding: 16px;
        background-color: #f8f8f8;
        border-radius: 8px;
        word-break: break-all;
      }

      .result p {
        margin: 8px 0;
        line-height: 1.5;
      }

      .result p:last-child {
        font-size: 1.1rem;
        font-weight: 600;
        color: #333;
      }

      .fixed-bottom {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 12px 16px;
        background-color: #fff;
        box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
      }

      .bottom-spacing {
        height: 80px;
      }

      .selected-position {
        margin-top: 12px;
        padding: 8px;
        background-color: #e3f2fd;
        border-radius: 4px;
        text-align: center;
        font-weight: bold;
        color: #1976d2;
      }

      #tempTimeGroup {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>主管常用表格</h2>

      <!-- 新增常用链接栏目 -->
      <div class="quick-links">
        <button
          class="quick-link-btn"
          onclick="window.location.href='https://docs.qq.com/sheet/DVUhRTGJKS3hTdkFx'"
        >
          排班表
        </button>
        <button
          class="quick-link-btn"
          onclick="window.location.href='https://docs.qq.com/sheet/DS2poZEhocEFEb1pS?tab=zwbgiy'"
        >
          空岗表
        </button>
        <button
          class="quick-link-btn"
          onclick="window.location.href='https://docs.qq.com/sheet/DVVpLd0ZTRnhLa1Fz'"
        >
          裸辞表
        </button>
        <button
          class="quick-link-btn"
          onclick="window.location.href='https://docs.qq.com/sheet/DS0pWdlRvRkl0bG5Q'"
        >
          黑名单
        </button>
      </div>
      <h2>请假信息生成器</h2>
      <div class="form-group">
        <label>日期标记</label>
        <select id="datePrefix" onchange="updateDate()">
          <option value="今天">今天</option>
          <option value="明天">明天</option>
          <option value="后天">后天</option>
          <option value="本周一">周一</option>
          <option value="本周二">周二</option>
          <option value="本周三">周三</option>
          <option value="本周四">周四</option>
          <option value="本周五">周五</option>
          <option value="本周六">周六</option>
          <option value="本周日">周日</option>
        </select>
      </div>
      <div class="form-group">
        <label>具体日期</label>
        <input type="text" id="date" readonly />
      </div>
      <div class="form-group">
        <label>班次</label>
        <select id="shift">
          <option value="早班">早班</option>
          <option value="午班">午班</option>
          <option value="晚班">晚班</option>
        </select>
      </div>
      <div class="form-group">
        <label>楼栋号</label>
        <div id="position-grid" class="position-grid"></div>
        <div id="selected-position" class="selected-position">请选择楼栋号</div>
      </div>
      <div class="form-group">
        <label>姓名</label>
        <input type="text" id="name" placeholder="请输入姓名" />
      </div>
      <div class="form-group">
        <label>请假类型</label>
        <select id="leaveType" onchange="toggleTempTimeGroup()">
          <option value="请假">请假</option>
          <option value="请假不当">请假不当</option>
          <option value="接班">接班</option>
          <option value="临时请假">临时请假</option>
        </select>
      </div>
      <div id="tempTimeGroup" class="form-group">
        <label>临时请假时间</label>
        <div class="time-group">
          <input type="time" id="startTime" class="time-input" />
          <span>至</span>
          <input type="time" id="endTime" class="time-input" />
        </div>
      </div>
      <div id="result"></div>
      <div class="bottom-spacing"></div>
    </div>

    <div class="fixed-bottom">
      <div class="button-group">
        <button class="generate-btn" onclick="generateMessage()">
          生成请假信息
        </button>
      </div>
    </div>

    <script>
      let selectedPosition = "";

      function initializePositionGrid() {
        const grid = document.getElementById("position-grid");
        for (let i = 1; i <= 27; i++) {
          if (i === 5) {
            const buttonA = document.createElement("button");
            const buttonB = document.createElement("button");
            buttonA.textContent = "5A#";
            buttonB.textContent = "5B#";
            buttonA.className = "position-btn";
            buttonB.className = "position-btn";
            buttonA.onclick = () => selectPosition("5A#");
            buttonB.onclick = () => selectPosition("5B#");
            grid.appendChild(buttonA);
            grid.appendChild(buttonB);
          } else {
            const button = document.createElement("button");
            button.textContent = `${i}#`;
            button.className = "position-btn";
            button.onclick = () => selectPosition(`${i}#`);
            grid.appendChild(button);
          }
        }
      }

      function toggleTempTimeGroup() {
        const leaveType = document.getElementById("leaveType").value;
        const tempTimeGroup = document.getElementById("tempTimeGroup");
        tempTimeGroup.style.display =
          leaveType === "临时请假" ? "block" : "none";
      }

      function selectPosition(position) {
        selectedPosition = position;
        document.querySelectorAll(".position-btn").forEach((btn) => {
          btn.classList.remove("selected");
          if (btn.textContent === position) {
            btn.classList.add("selected");
          }
        });
        document.getElementById(
          "selected-position"
        ).textContent = `已选择: ${position}`;
      }

      function getDateOfWeek(dayName) {
        const days = {
          本周一: 1,
          本周二: 2,
          本周三: 3,
          本周四: 4,
          本周五: 5,
          本周六: 6,
          本周日: 0,
        };

        const today = new Date();
        const currentDay = today.getDay();
        const targetDay = days[dayName];

        let diff = targetDay - currentDay;
        if (targetDay === 0) diff = 7 - currentDay;
        if (diff <= 0) diff += 7;

        const targetDate = new Date(today);
        targetDate.setDate(today.getDate() + diff);

        return `${targetDate.getMonth() + 1}.${targetDate.getDate()}`;
      }

      function getDateByOffset(offset) {
        const date = new Date();
        date.setDate(date.getDate() + offset);
        return `${date.getMonth() + 1}.${date.getDate()}`;
      }

      function updateDate() {
        const datePrefix = document.getElementById("datePrefix").value;
        let dateStr;

        if (datePrefix.startsWith("本周")) {
          dateStr = getDateOfWeek(datePrefix);
        } else {
          const offset =
            datePrefix === "明天" ? 1 : datePrefix === "后天" ? 2 : 0;
          dateStr = getDateByOffset(offset);
        }

        document.getElementById("date").value = dateStr;
      }

      function calculateTimeDifference(start, end) {
        const [startHours, startMinutes] = start.split(":").map(Number);
        const [endHours, endMinutes] = end.split(":").map(Number);

        let diffMinutes =
          endHours * 60 + endMinutes - (startHours * 60 + startMinutes);

        // 如果结束时间小于开始时间，假设跨天，加24小时
        if (diffMinutes < 0) {
          diffMinutes += 24 * 60;
        }

        return diffMinutes;
      }

      function generateMessage() {
        const datePrefix = document.getElementById("datePrefix").value;
        const date = document.getElementById("date").value;
        const shift = document.getElementById("shift").value;
        const name = document.getElementById("name").value;
        const leaveType = document.getElementById("leaveType").value;

        if (!selectedPosition || !name) {
          alert("请填写完整信息！");
          return;
        }

        let message = `请假：${datePrefix}（${date}）${shift} ${selectedPosition} ${name} ${leaveType}`;

        if (leaveType === "临时请假") {
          const startTime = document.getElementById("startTime").value;
          const endTime = document.getElementById("endTime").value;
          if (!startTime || !endTime) {
            alert("请填写临时请假时间！");
            return;
          }
          const diffMinutes = calculateTimeDifference(startTime, endTime);
          message += ` ${diffMinutes}mins (${startTime}-${endTime})`;
        }

        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = `
          <div class="result">
            <p>生成的信息：</p>
            <p>${message}</p>
          </div>
          <div class="button-group">
            <button onclick="copyToClipboard('${message}')" class="copy-button">复制到剪贴板</button>
          </div>
        `;

        resultDiv.scrollIntoView({ behavior: "smooth" });
      }

      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            alert("已复制到剪贴板！");
          })
          .catch((err) => {
            alert("复制失败，请手动复制。");
            console.error("复制失败:", err);
          });
      }

      window.onload = function () {
        updateDate();
        initializePositionGrid();
        toggleTempTimeGroup();
      };
    </script>
  </body>
</html>
